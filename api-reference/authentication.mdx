---
title: "Authentication"
description: "Complete guide to authentication in the Mdadda API using Firebase Authentication and JWT tokens"
icon: "shield-check"
---

## Overview

The Mdadda API uses Firebase Authentication as the primary authentication method, providing secure access to the house helper marketplace platform. This system supports both email/password authentication and social login providers (Google, Facebook, Apple).

<Card title="Two-Step Registration Process" icon="user-plus">
  Mdadda uses a two-step registration process:
  1. **Basic Registration**: Create account with minimal information
  2. **Onboarding**: Complete profile with role-specific details
</Card>

## Authentication Flow

### 1. Basic Registration

Create a new user account with minimal required information. The user will need to complete onboarding separately.

**Required Parameters:**

- `email` (string, required): User's email address (must be unique)
- `password` (string, required): User's password (minimum 8 characters)
- `first_name` (string, required): User's first name
- `last_name` (string, required): User's last name
- `role` (string, required): User's role: `house_helper` or `house_holder`
- `username` (string, optional): Optional username (will be auto-generated if not provided)

<CodeGroup>
```javascript JavaScript
// Basic registration - key pattern: role specification
const response = await fetch('/api/v1/auth/register/basic/', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    email: 'jane.doe@example.com',
    password: 'SecurePass123!',
    first_name: 'Jane',
    last_name: 'Doe',
    role: 'house_helper' // Required: 'house_helper' or 'house_holder'
  })
});
```

```python Python
# Key pattern: role specification and token handling
payload = {
    "email": "jane.doe@example.com",
    "password": "SecurePass123!",
    "first_name": "Jane",
    "last_name": "Doe",
    "role": "house_helper"  # Required: 'house_helper' or 'house_holder'
}

response = requests.post(f"{api_url}/auth/register/basic/", json=payload)
if response.ok:
    data = response.json()
    # Store tokens for subsequent requests
    access_token = data['tokens']['access_token']
```

```bash cURL
# Key pattern: role is required field
curl -X POST https://api.mdadda.com/api/v1/auth/register/basic/ \
  -H "Content-Type: application/json" \
  -d '{
    "email": "jane.doe@example.com",
    "password": "SecurePass123!",
    "first_name": "Jane",
    "last_name": "Doe",
    "role": "house_helper"
  }'
```
</CodeGroup>

**Response:**
```json
{
  "message": "User account created successfully. Please complete your profile.",
  "tokens": {
    "access_token": "eyJhbGciOiJSUzI1NiIs...",
    "refresh_token": "refresh_token_123...",
    "expires_in": 3600,
    "token_type": "Bearer"
  },
  "onboarding_required": true
}
```

### 2. Complete Onboarding

After basic registration, users must complete their profile with role-specific information. This endpoint accepts `multipart/form-data` to handle file uploads.

<Warning>
  For house helpers, `dob`, `job_type`, and `skills` are required fields. The API will validate these based on the user's role.
</Warning>

**Common Fields (All Users):**

- `phone_number` (string): Phone number in international format (Kenya region: +254...)
- `bio` (string): User biography or description
- `current_city` (string): Current city of residence
- `nationality` (string): User's nationality
- `gender` (string): User's gender: `male`, `female`, or `other`
- `profile_picture` (file): Profile picture image file

**House Helper Specific Fields:**

- `dob` (date, **required**): Date of birth (YYYY-MM-DD format)
- `job_type` (string, **required**): Job type
- `skills` (array, **required**): Array of skill names
- `experience_years` (integer): Years of experience
- `hourly_rate` (decimal): Hourly rate in KES
- `languages` (array): Languages spoken
- `certifications` (array): Professional certifications
- `education_level` (string): Education level options: `primary`, `secondary`, `diploma`, `degree`, `masters`, `phd`, `other`
- `preferred_working_hours` (string): Options: `full_day`, `half_day`, `flexible`, `night_shift`

**House Holder Specific Fields:**

- `household_size` (integer): Number of people in household (default: 1)
- `number_of_children` (integer): Number of children in household
- `has_pets` (boolean): Whether household has pets
- `salary_range_min` (integer): Minimum salary range in KES
- `salary_range_max` (integer): Maximum salary range in KES

<Tabs>
  <Tab title="House Helper Onboarding">
    <CodeGroup>
    ```javascript JavaScript
    // Key pattern: FormData for file uploads + required fields for house helpers
    const formData = new FormData();
    formData.append('dob', '1990-05-15');        // Required
    formData.append('job_type', 'full_time');    // Required
    formData.append('phone_number', '+254712345678');

    // Skills array - Required for house helpers
    ['cooking', 'cleaning'].forEach(skill => {
        formData.append('skills', skill);
    });

    const response = await fetch('/api/v1/auth/onboarding/', {
      method: 'POST',
      headers: { 'Authorization': `Bearer ${accessToken}` },
      body: formData
    });
    ```

    ```python Python
    # Key pattern: multipart form data with required fields
    data = {
        "dob": "1990-05-15",       # Required for house helpers
        "job_type": "full_time",   # Required for house helpers
        "phone_number": "+254712345678"
    }

    # Skills array handling - Required for house helpers
    for skill in ["cooking", "cleaning"]:
        data["skills"] = skill

    response = requests.post(url, headers=headers, data=data)
    ```
    </CodeGroup>
  </Tab>

  <Tab title="House Holder Onboarding">
    <CodeGroup>
    ```javascript JavaScript
    // Key pattern: house holder specific fields
    const formData = new FormData();
    formData.append('phone_number', '+254712345678');
    formData.append('household_size', '4');
    formData.append('salary_range_min', '20000');
    formData.append('salary_range_max', '40000');

    // Optional arrays
    ['dog', 'cat'].forEach(pet => {
        formData.append('pet_types', pet);
    });

    const response = await fetch('/api/v1/auth/onboarding/', {
      method: 'POST',
      headers: { 'Authorization': `Bearer ${accessToken}` },
      body: formData
    });
    ```

    ```python Python
    # Key pattern: house holder specific fields
    data = {
        "phone_number": "+254712345678",
        "household_size": 4,
        "salary_range_min": 20000,
        "salary_range_max": 40000
    }

    # Handle arrays
    for pet in ["dog", "cat"]:
        data["pet_types"] = pet

    response = requests.post(url, headers=headers, data=data)
    ```
    </CodeGroup>
  </Tab>
</Tabs>

### 3. User Login

Authenticate existing users with email and password. Returns Firebase tokens for API access.

**Parameters:**

- `email` (string, required): User's email address
- `password` (string, required): User's password
- `fcm_token` (string, optional): Firebase Cloud Messaging token for push notifications
- `device_id` (string, optional): Unique device identifier for tracking
- `device_type` (string, optional): Device type: `android`, `ios`, or `web`

<CodeGroup>
```javascript JavaScript - AuthService
// Key pattern: FCM token inclusion for notifications
import { authService } from '@/lib/services/authentication/AuthService';
import { FCMService } from '@/lib/services/FCMService';

const loginData = {
  email: 'user@example.com',
  password: 'password',
  fcm_token: await FCMService.getFCMToken(), // Critical for notifications
  device_type: 'web'
};

const user = await authService.login(loginData);
// Tokens and Firebase auth handled automatically
```

```javascript JavaScript - React Hook
// Key pattern: proper error handling
import { useAuth } from '@/lib/contexts/auth-context';

const { login, isLoading, error } = useAuth();

try {
  await login(formData);
  router.push('/dashboard');
} catch (err) {
  toast.error(err.message); // Critical: show user-friendly errors
}
```

```python Python
# Key pattern: environment variables and token storage
api_url = os.getenv('API_URL', 'https://api.mdadda.com/api/v1')
payload = {
    "email": "user@example.com",
    "password": "password",
    "device_type": "web"
}

response = requests.post(f"{api_url}/auth/login/", json=payload)
if response.ok:
    tokens = response.json()["tokens"]
    # Store securely for subsequent requests
    access_token = tokens["access_token"]
```

```bash cURL
# Key pattern: environment variable usage and token extraction
curl -X POST "${API_URL:-https://api.mdadda.com/api/v1}/auth/login/" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user@example.com",
    "password": "password",
    "device_type": "web"
  }' | jq -r '.tokens.access_token'
```
</CodeGroup>

**Response:**
```json
{
  "message": "Login successful",
  "tokens": {
    "access_token": "eyJhbGciOiJSUzI1NiIs...",
    "refresh_token": "refresh_token_123...",
    "expires_in": 3600,
    "token_type": "Bearer"
  }
}
```

## Social Authentication

Authenticate using social providers (Google, Facebook) with a two-step OAuth flow: initialization and completion.

### Step 1: Initialize Social Authentication

Get the OAuth authorization URL for the selected provider.

**Parameters:**

- `auth_type` (string, required): Must be `init` for initialization
- `provider` (string, required): Social provider: `google` or `facebook`
- `redirect_uri` (string, required): Your application's OAuth callback URL

<CodeGroup>
```javascript JavaScript
// Key pattern: two-step OAuth flow
const response = await fetch('/api/v1/auth/social-auth/', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    auth_type: 'init',
    provider: 'google',
    redirect_uri: 'https://yourdomain.com/auth/callback'
  })
});

// Redirect to provider
window.location.href = response.json().auth_url;
```

```python Python
# Key pattern: init step returns auth_url
payload = {
    "auth_type": "init",
    "provider": "google",
    "redirect_uri": "https://yourdomain.com/auth/callback"
}

response = requests.post(f"{api_url}/auth/social-auth/", json=payload)
auth_url = response.json()["auth_url"]
# Redirect user to auth_url
```
</CodeGroup>

### Step 2: Complete Social Authentication

After user completes OAuth flow and returns with authorization code.

**Parameters:**

- `auth_type` (string, required): Must be `complete` for completion
- `provider` (string, required): Social provider: `google` or `facebook`
- `code` (string, required): OAuth authorization code from provider
- `redirect_uri` (string, required): Same redirect URI used in initialization

<CodeGroup>
```javascript JavaScript
// Key pattern: complete step with auth code
const authCode = new URLSearchParams(window.location.search).get('code');

const response = await fetch('/api/v1/auth/social-auth/', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    auth_type: 'complete',
    provider: 'google',
    code: authCode,
    redirect_uri: 'https://yourdomain.com/auth/callback'
  })
});

// Store tokens
localStorage.setItem('access_token', response.json().tokens.access_token);
```

```python Python
# Key pattern: complete step returns tokens
payload = {
    "auth_type": "complete",
    "provider": "google",
    "code": auth_code,  # From OAuth callback
    "redirect_uri": "https://yourdomain.com/auth/callback"
}

response = requests.post(f"{api_url}/auth/social-auth/", json=payload)
tokens = response.json()["tokens"]
# Store tokens securely
```
</CodeGroup>

**Step 1 Response (Init):**
```json
{
  "auth_url": "https://accounts.google.com/oauth/authorize?client_id=..."
}
```

**Step 2 Response (Complete):**
```json
{
  "message": "Social authentication successful",
  "tokens": {
    "access_token": "eyJhbGciOiJSUzI1NiIs...",
    "refresh_token": "refresh_token_123...",
    "expires_in": 3600,
    "token_type": "Bearer"
  },
  "user": {
    "id": "123e4567-e89b-12d3-a456-426614174000",
    "email": "jane.doe@example.com",
    "first_name": "Jane",
    "last_name": "Doe",
    "role": "house_helper",
    "is_active": true,
    "is_staff": false,
    "date_joined": "2024-01-15T10:30:00Z",
    "social_provider": "google",
    "social_id": "google_user_123",
    "phone_number": "+254712345678",
    "dob": "1990-05-15"
  }
}
```

## Token Management

### Refresh Access Token

When your access token expires, use the Firebase user UID to get a new token.

**Parameters:**

- `uid` (string, required): Firebase user UID

<CodeGroup>
```javascript JavaScript
// Key pattern: automatic token refresh
const response = await fetch('/api/v1/auth/refresh-token/', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ uid: firebase_user_uid })
});

const { access_token, refresh_token } = await response.json();
localStorage.setItem('access_token', access_token);
```

```python Python
# Key pattern: refresh with Firebase UID
payload = {"uid": firebase_user_uid}
response = requests.post(f"{api_url}/auth/refresh-token/", json=payload)

# Update tokens
tokens = response.json()
access_token = tokens["access_token"]
```
</CodeGroup>

### Making Authenticated Requests

Include the access token in the Authorization header for all authenticated requests. The AuthService provides automatic token management.

<CodeGroup>
```javascript JavaScript - AuthService
// Key pattern: automatic token management
import { authService } from '@/lib/services/authentication/AuthService';

// AuthService handles token refresh automatically
const token = await authService.getAccessToken();

const response = await fetch('/users/profile/', {
  headers: { 'Authorization': `Bearer ${token}` }
});
```

```javascript JavaScript - Custom API Helper
// Key pattern: built-in error handling and refresh
const apiRequest = async (endpoint, options = {}) => {
  const token = await authService.getAccessToken();
  const response = await fetch(endpoint, {
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json',
      ...options.headers
    },
    ...options
  });

  if (!response.ok) throw new Error(await response.json().message);
  return response.json();
};
```

```python Python
# Key pattern: Bearer token authorization
headers = {"Authorization": f"Bearer {access_token}"}
response = requests.get(f"{api_url}/protected-endpoint/", headers=headers)
```

```bash cURL
# Key pattern: Bearer token in Authorization header
curl -H "Authorization: Bearer $ACCESS_TOKEN" \
     "$API_URL/protected-endpoint/"
```
</CodeGroup>

## Password Management

### Change Password

Change the current user's password (requires current password for verification).

<CodeGroup>
```javascript JavaScript
// Key pattern: current password required for verification
const response = await fetch('/api/v1/auth/change-password/', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${accessToken}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    current_password: 'OldPassword123!',
    new_password: 'NewSecurePass123!'
  })
});
```

```python Python
# Key pattern: requires current password verification
payload = {
    "current_password": "OldPassword123!",
    "new_password": "NewSecurePass123!"
}
response = requests.post(f"{api_url}/auth/change-password/",
                        headers=headers, json=payload)
```
</CodeGroup>

### Reset Password

The password reset endpoint handles two scenarios: sending a reset email or completing a password reset with a token.

#### Send Password Reset Email

Send a password reset email to the user's registered email address.

**Parameters:**

- `email` (string, required): User's email address to send reset instructions

<CodeGroup>
```javascript JavaScript
// Key pattern: email-only for reset request
const response = await fetch('/api/v1/auth/reset-password/', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ email: 'user@example.com' })
});

// Reset email sent
```

```python Python
# Key pattern: just email for reset request
payload = {"email": "user@example.com"}
response = requests.post(f"{api_url}/auth/reset-password/", json=payload)
# Reset email sent
```
</CodeGroup>

#### Complete Password Reset with Token

Reset password using the token received via email.

**Parameters:**

- `email` (string, required): User's email address
- `token` (string, required): Firebase oobCode token from reset email
- `new_password` (string, required): New password (minimum 8 characters)
- `confirm_password` (string, required): Confirmation of new password (must match new_password)

<CodeGroup>
```javascript JavaScript
// Key pattern: token from email + password confirmation
const response = await fetch('/api/v1/auth/reset-password/', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    email: 'user@example.com',
    token: 'firebase_oob_code_from_email', // From reset email
    new_password: 'NewPass123!',
    confirm_password: 'NewPass123!'
  })
});
```

```python Python
# Key pattern: token completion with confirmation
payload = {
    "email": "user@example.com",
    "token": "firebase_oob_code_from_email",
    "new_password": "NewPass123!",
    "confirm_password": "NewPass123!"
}
response = requests.post(f"{api_url}/auth/reset-password/", json=payload)
```
</CodeGroup>

## User Logout

Log out the current user and invalidate their session.

<CodeGroup>
```javascript JavaScript - AuthService
// Key pattern: comprehensive cleanup
import { authService } from '@/lib/services/authentication/AuthService';

await authService.logout();
// Automatically: API call, Firebase signout, storage cleanup
```

```javascript JavaScript - React Hook
// Key pattern: proper error handling
import { useAuth } from '@/lib/contexts/auth-context';

const { logout } = useAuth();

try {
  await logout();
  toast.success('Logged out successfully');
} catch (error) {
  toast.error('Logout failed. Please try again.');
}
```

```javascript JavaScript - Manual Cleanup
// Key pattern: clear all auth data
fetch('/api/v1/auth/logout/', {
  method: 'POST',
  headers: { 'Authorization': `Bearer ${token}` }
});

// Clear stored data
['accessToken', 'refreshToken', 'user'].forEach(key =>
  localStorage.removeItem(key)
);
```

```python Python
# Key pattern: cleanup regardless of API response
try:
    requests.post(f"{api_url}/auth/logout/", headers=headers)
except:
    pass  # Continue with cleanup even if API fails
finally:
    # Always clear tokens
    access_token = None
    refresh_token = None
```
</CodeGroup>

## Account Management

### Delete Account

Permanently delete the current user's account and all associated data.

<Warning>
  Account deletion is permanent and cannot be undone. All user data, including matches, conversations, and verification status, will be permanently removed.
</Warning>

**Parameters:**

- `email` (string, required): User's email address for confirmation (must match authenticated user's email)
- `confirm_deletion` (boolean, required): Must be `true` to confirm account deletion
- `reason` (string, optional): Optional reason for account deletion (max 500 characters)

<CodeGroup>
```javascript JavaScript
// Key pattern: email confirmation required
const response = await fetch('/api/v1/auth/delete-account/', {
  method: 'DELETE',
  headers: {
    'Authorization': `Bearer ${accessToken}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    email: 'user@example.com', // Must match authenticated user
    confirm_deletion: true,
    reason: 'No longer needed' // Optional
  })
});
```

```python Python
# Key pattern: email must match authenticated user
payload = {
    "email": "user@example.com",  # Must match authenticated user
    "confirm_deletion": True,
    "reason": "No longer needed"  # Optional
}
response = requests.delete(f"{api_url}/auth/delete-account/",
                          headers=headers, json=payload)
```
</CodeGroup>

**Response:**
```json
{
  "message": "Account deleted successfully",
  "deleted_at": "2024-01-15T10:30:00Z",
  "warning": "This action is irreversible. All your data has been permanently removed."
}
```

## Legacy Endpoints

### Legacy Complete Registration (Deprecated)

<Warning>
  **This endpoint is deprecated** and will be removed in future versions. Use the two-step flow (basic registration + onboarding) instead for new implementations.
</Warning>

The legacy registration endpoint allows complete user registration in one step but is being phased out in favor of the more flexible two-step process.

**Endpoint:** `POST /auth/register/`

**Content-Type:** `multipart/form-data` (supports file uploads)

**Required Parameters:**

- `email` (string, required): User's email address
- `password` (string, required): User's password (minimum 8 characters)
- `first_name` (string, required): User's first name
- `last_name` (string, required): User's last name
- `dob` (date, required): Date of birth (YYYY-MM-DD format)
- `phone_number` (string, required): Phone number in international format
- `role` (string, required): User's role: `house_helper` or `house_holder`

**Optional Parameters:**

- `username` (string): Optional username (auto-generated if not provided)
- `job_type` (string): Job type (required for house helpers)
- `nationality` (string): User's nationality
- `household_size` (integer): Number of people in household (for house holders, default: 1)
- `skills` (array): List of skill names (required for house helpers)

<Tabs>
  <Tab title="House Helper Registration">
    <CodeGroup>
    ```javascript JavaScript
    // DEPRECATED: Use basic registration + onboarding instead
    const formData = new FormData();
    formData.append('email', 'user@example.com');
    formData.append('role', 'house_helper');
    formData.append('dob', '1990-05-15');      // Required in legacy
    formData.append('job_type', 'full_time');  // Required for helpers

    // Skills required for helpers
    ['cooking', 'cleaning'].forEach(skill => {
        formData.append('skills', skill);
    });

    const response = await fetch('/api/v1/auth/register/', {
      method: 'POST',
      body: formData
    });
    ```

    ```python Python
    # DEPRECATED: Use basic registration + onboarding instead
    data = {
        "email": "user@example.com",
        "role": "house_helper",
        "dob": "1990-05-15",      # Required in legacy
        "job_type": "full_time",  # Required for helpers
    }

    # Skills required for helpers
    for skill in ["cooking", "cleaning"]:
        data["skills"] = skill

    response = requests.post(f"{api_url}/auth/register/", data=data)
    ```

    ```bash cURL
    # DEPRECATED: Use basic registration + onboarding instead
    curl -X POST $API_URL/auth/register/ \
      -F "email=user@example.com" \
      -F "role=house_helper" \
      -F "dob=1990-05-15" \
      -F "job_type=full_time" \
      -F "skills=cooking" \
      -F "skills=cleaning"
    ```
    </CodeGroup>
  </Tab>

  <Tab title="House Holder Registration">
    <CodeGroup>
    ```javascript JavaScript
    // DEPRECATED: Use basic registration + onboarding instead
    const formData = new FormData();
    formData.append('email', 'user@example.com');
    formData.append('role', 'house_holder');
    formData.append('dob', '1985-03-20');        // Required in legacy
    formData.append('household_size', '4');

    const response = await fetch('/api/v1/auth/register/', {
      method: 'POST',
      body: formData
    });
    ```

    ```python Python
    # DEPRECATED: Use basic registration + onboarding instead
    data = {
        "email": "user@example.com",
        "role": "house_holder",
        "dob": "1985-03-20",      # Required in legacy
        "household_size": 4
    }

    response = requests.post(f"{api_url}/auth/register/", data=data)
    ```

    ```bash cURL
    # DEPRECATED: Use basic registration + onboarding instead
    curl -X POST $API_URL/auth/register/ \
      -F "email=user@example.com" \
      -F "role=house_holder" \
      -F "dob=1985-03-20" \
      -F "household_size=4"
    ```
    </CodeGroup>
  </Tab>
</Tabs>

**Response:**
```json
{
  "message": "User registered successfully",
  "tokens": {
    "access_token": "eyJhbGciOiJSUzI1NiIs...",
    "refresh_token": "refresh_token_123...",
    "expires_in": 3600,
    "token_type": "Bearer"
  }
}
```

**Validation Rules:**

- **House Helpers**: Must include `job_type` and at least one skill in the `skills` array
- **House Holders**: No additional required fields beyond the basic requirements
- **All Users**: `dob` and `phone_number` are required (unlike the new two-step flow where these are handled in onboarding)

**Migration Recommendation:**

For new implementations, use the modern two-step flow:

1. **Step 1**: Use `/auth/register/basic/` for account creation
2. **Step 2**: Use `/auth/onboarding/` for profile completion

This provides better user experience, validation, and flexibility for handling complex profile requirements.

## Frontend Implementation Guide

### Environment Variables

Critical environment variables developers often miss:

```bash
# Essential vars - API and Firebase
NEXT_PUBLIC_API_URL=https://api.mdadda.com/api/v1
NEXT_PUBLIC_FIREBASE_PROJECT_ID=your_project_id
NEXT_PUBLIC_VAPID_KEY=your_vapid_key  # Required for notifications
```

### TypeScript Interfaces

Essential type definitions:

```typescript
// Key interface: LoginData with FCM token
export interface LoginData {
  email: string;
  password: string;
  fcm_token?: string;  // Critical for notifications
  device_type?: 'web' | 'android' | 'ios';
}

// Key interface: Role specification
export interface RegisterData {
  email: string;
  password: string;
  role: "house_holder" | "house_helper";  // Required
  first_name: string;
  last_name: string;
}
```

### Firebase Integration

Key pattern: Custom token authentication

```typescript
// Critical pattern: signInWithCustomToken for API integration
import { signInWithCustomToken } from 'firebase/auth';
import { auth } from '@/lib/firebase/firebase';

// After API login, sign into Firebase with custom token
if (loginResponse.tokens?.access_token) {
  await signInWithCustomToken(auth, loginResponse.tokens.access_token);
}
```

### Error Handling Patterns

Key error types to handle:

```typescript
// Essential error handling
function handleAuthError(error: unknown): string {
  const message = error.message || 'Unknown error';

  // Key Firebase errors
  if (message.includes('auth/invalid-action-code')) {
    return 'Invalid or expired reset link';
  }
  if (message.includes('HTTP 500')) {
    return 'Server error. Please try again';
  }

  return message;
}
```

### Form Validation

Essential validation patterns:

```typescript
// Key validation: Email regex and password length
const EMAIL_REGEX = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

function validateLoginForm(data: LoginData): string | null {
  if (!EMAIL_REGEX.test(data.email)) return 'Invalid email';
  if (data.password.length < 8) return 'Password too short';
  return null;
}
```

### Loading States and UX

Key pattern: Disabled state during processing

```typescript
// Essential loading pattern
const [isLoading, setIsLoading] = useState(false);

function LoadingButton({ isLoading, children, ...props }) {
  return (
    <button disabled={isLoading} {...props}>
      {isLoading ? 'Processing...' : children}
    </button>
  );
}
```

### Toast Notifications

Key pattern: User feedback

```typescript
import { toast } from 'sonner';

// Essential patterns
toast.success('Login successful!');
toast.error('Login failed');

// Loading with update
const id = toast.loading('Signing in...');
toast.success('Success!', { id });
```

### AuthService Usage

Key patterns:

```typescript
import { authService } from '@/lib/services/authentication/AuthService';

// Essential methods
const user = await authService.login(loginData);
const token = await authService.getAccessToken();  // Auto-refresh
const isAuth = authService.isAuthenticated();

// State change listener
const unsubscribe = authService.onAuthStateChanged((user) => {
  // Handle auth state changes
});
```

### React Context Integration

Key hook usage:

```typescript
import { useAuth } from '@/lib/contexts/auth-context';

function MyComponent() {
  const { user, isLoading, login, logout, error } = useAuth();

  // Essential patterns covered in hook
}
```

### Route Protection

Key pattern: Middleware protection

```typescript
// middleware.ts - Essential route protection
export function middleware(request: NextRequest) {
  const token = request.cookies.get('accessToken')?.value;

  if (!token && request.nextUrl.pathname.startsWith('/protected')) {
    return NextResponse.redirect(new URL('/auth/login', request.url));
  }

  return NextResponse.next();
}
```

## API Endpoints Summary

| Endpoint | Method | Description |
|----------|---------|-------------|
| `/auth/register/basic/` | POST | Basic user registration |
| `/auth/onboarding/` | POST | Complete user profile |
| `/auth/register/` | POST | Legacy complete registration (deprecated) |
| `/auth/login/` | POST | User authentication |
| `/auth/logout/` | POST | User logout |
| `/auth/refresh-token/` | POST | Refresh access token |
| `/auth/social-auth/` | POST | Social authentication (init/complete) |
| `/auth/change-password/` | POST | Change password |
| `/auth/reset-password/` | POST | Reset password |
| `/auth/delete-account/` | DELETE | Delete user account |
| `/auth/restore-account/` | POST | Restore account (admin only) |
| `/auth/deletion-info/` | GET | Get deletion information |

## Error Handling

The API returns standard HTTP status codes and detailed error messages:

**Common Error Responses:**

```json
// 400 Bad Request - Validation Error
{
  "error": "Email is already in use"
}

// 400 Bad Request - Onboarding Validation
{
  "error": "Date of birth is required for house helpers."
}

// 401 Unauthorized
{
  "error": "Invalid User Credentials"
}

// 403 Forbidden - Admin Only
{
  "error": "Only administrators can restore accounts"
}

// 500 Internal Server Error
{
  "error": "Failed to create Firebase user"
}
```

## Security Best Practices

<Tip>
  Follow these security best practices when implementing authentication:
</Tip>

1. **Store tokens securely**: Use secure storage mechanisms (Keychain on iOS, Keystore on Android)
2. **Handle token expiration**: Implement automatic token refresh before expiration
3. **Validate responses**: Always check response status and handle errors appropriately
4. **Use HTTPS**: Never send authentication data over unencrypted connections
5. **Implement logout**: Provide clear logout functionality that clears all stored tokens

## Next Steps

<CardGroup cols={2}>
  <Card title="User Profiles" href="/api-reference/users" icon="user">
    Learn how to manage user profiles and settings
  </Card>
  <Card title="Marketplace" href="/api-reference/marketplace" icon="store">
    Explore marketplace features and token system
  </Card>
  <Card title="Matching System" href="/api-reference/matching" icon="heart">
    Understand how helper-holder matching works
  </Card>
  <Card title="Real-time Chat" href="/api-reference/chat" icon="message">
    Implement real-time messaging features
  </Card>
</CardGroup>